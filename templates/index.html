<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartHire AI Recruitment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind configuration for custom colors and font
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#4f46e5',
                        'primary-dark': '#4338ca',
                        'secondary': '#f97316',
                        'success': '#10b981',
                        'danger': '#ef4444',
                        'warning': '#f59e0b',
                    }
                }
            }
        }
    </script>
    <style>
        .page-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #f3f4f6;
        }
        .flash-message {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
            max-width: 90%;
            cursor: pointer;
        }
    </style>
</head>
<body class="font-sans page-container">

<header class="bg-primary shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <a href="{{ url_for('index') }}" class="text-white text-2xl font-bold tracking-tight hover:text-secondary transition duration-150">
                SmartHire
            </a>
            <nav class="flex space-x-4">
                <a href="{{ url_for('index') }}" class="text-white hover:text-secondary transition duration-150 py-2 px-3 rounded-md text-sm font-medium">Job Postings</a>
                <a href="{{ url_for('post_job') }}" class="bg-secondary text-white hover:bg-orange-600 transition duration-150 py-2 px-3 rounded-lg text-sm font-medium shadow-md">Post New Job</a>
            </nav>
        </div>
    </div>
</header>

<main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
    
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-message space-y-2">
                {% for category, message in messages %}
                    <div onclick="this.remove()" class="p-4 rounded-lg shadow-xl text-white font-medium flex items-center justify-between transition duration-300 transform hover:scale-[1.02] 
                        {% if category == 'success' %}bg-success{% elif category == 'danger' %}bg-danger{% elif category == 'warning' %}bg-warning{% else %}bg-primary{% endif %}">
                        <span>{{ message }}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content Rendering Logic based on the requested URL -->
    
    {% if request.path == url_for('index') %}
        <!-- Home Page (Job Postings List) -->
        <h1 class="text-4xl font-extrabold text-gray-900 mb-8 border-b-4 border-primary pb-2">Available Job Postings</h1>
        
        <div class="space-y-6">
            {% for job in job_postings %}
                <div class="bg-white p-6 rounded-xl shadow-2xl border-l-8 border-primary transition duration-300 hover:shadow-primary/20">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                        <div class="mb-4 md:mb-0">
                            <h2 class="text-2xl font-bold text-gray-800">{{ job.title }}</h2>
                            <p class="text-sm text-gray-500 mt-1">Posted: {{ job.date_posted.strftime('%B %d, %Y') }}</p>
                        </div>
                        <div class="flex space-x-3">
                            <a href="{{ url_for('view_applications', job_id=job.id) }}" 
                               class="bg-gray-100 text-primary hover:bg-gray-200 py-2 px-4 rounded-lg text-sm font-medium transition duration-150 shadow-md">
                                View Applicants ({{ job.applications|length }})
                            </a>
                            <a href="{{ url_for('apply_job', job_id=job.id) }}" 
                               class="bg-secondary text-white hover:bg-orange-600 py-2 px-4 rounded-lg text-sm font-medium transition duration-150 shadow-md">
                                Apply Now
                            </a>
                        </div>
                    </div>
                    <p class="text-gray-600 mt-4 line-clamp-3">{{ job.description }}</p>
                </div>
            {% else %}
                <div class="text-center p-12 bg-white rounded-xl shadow-inner border-4 border-dashed border-gray-300">
                    <p class="text-xl text-gray-500 font-semibold">No job postings available yet.</p>
                    <p class="text-gray-400 mt-2">Be the first to <a href="{{ url_for('post_job') }}" class="text-primary hover:text-primary-dark font-medium underline">post a job</a>!</p>
                </div>
            {% endfor %}
        </div>

    {% elif request.path == url_for('post_job') %}
        <!-- Post Job Page -->
        <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-2xl border-t-8 border-primary">
            <h1 class="text-3xl font-bold text-gray-900 mb-6">Post a New Job Vacancy</h1>
            <form method="POST" action="{{ url_for('post_job') }}">
                <div class="mb-5">
                    <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Job Title</label>
                    <input type="text" id="title" name="title" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150 shadow-inner">
                </div>
                <div class="mb-6">
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Job Description (Required Skills & Responsibilities)</label>
                    <textarea id="description" name="description" rows="10" required
                              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition duration-150 shadow-inner"></textarea>
                </div>
                <button type="submit" class="w-full bg-primary text-white font-semibold py-3 rounded-lg hover:bg-primary-dark transition duration-200 shadow-lg hover:shadow-xl">
                    Post Job
                </button>
            </form>
        </div>

    {% elif request.path.startswith(url_for('apply_job', job_id=1)[:-1]) %}
        <!-- Apply Job Page -->
        {% set path_parts = request.path.split('/') %}
        {% set job_id = path_parts[-1] if path_parts[-1] != 'apply' else path_parts[-2] %}
        {% set job = get_job_by_id(job_id) %}
        <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-2xl border-t-8 border-secondary">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Apply for: {{ job.title }}</h1>
            <p class="text-gray-500 mb-6 border-b pb-4">Our AI will score your resume's relevancy to the job description below.</p>
            
            <div class="bg-gray-50 p-4 rounded-lg mb-6 border border-gray-200">
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Job Description Summary:</h3>
                <p class="text-sm text-gray-600 line-clamp-5">{{ job.description }}</p>
            </div>
            
            <form method="POST" action="{{ url_for('apply_job', job_id=job.id) }}" enctype="multipart/form-data">
                <div class="mb-5">
                    <label for="candidate_name" class="block text-sm font-medium text-gray-700 mb-1">Your Full Name</label>
                    <input type="text" id="candidate_name" name="candidate_name" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary transition duration-150 shadow-inner">
                </div>
                <div class="mb-5">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="email" name="email" required
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-secondary focus:border-secondary transition duration-150 shadow-inner">
                </div>
                <div class="mb-6">
                    <label for="resume" class="block text-sm font-medium text-gray-700 mb-1">Upload Resume (PDF only)</label>
                    <input type="file" id="resume" name="resume" accept=".pdf" required
                           class="block w-full text-sm text-gray-500
                                file:mr-4 file:py-2 file:px-4
                                file:rounded-full file:border-0
                                file:text-sm file:font-semibold
                                file:bg-primary file:text-white
                                hover:file:bg-primary-dark cursor-pointer transition duration-150
                           ">
                </div>
                <button type="submit" class="w-full bg-secondary text-white font-semibold py-3 rounded-lg hover:bg-orange-600 transition duration-200 shadow-lg hover:shadow-xl">
                    Submit Application
                </button>
            </form>
        </div>


    {% elif request.path.startswith(url_for('view_applications', job_id=1)[:-1]) %}
        <!-- View Applications Page -->
        {% set path_parts = request.path.split('/') %}
        {% set job_id = path_parts[-1] if path_parts[-1] != 'applications' else path_parts[-2] %}
        {% set job = get_job_by_id(job_id) %}
        
        <h1 class="text-4xl font-extrabold text-gray-900 mb-2">Applicants for: <span class="text-primary">{{ job.title }}</span></h1>
        <p class="text-xl text-gray-500 mb-8">Total Applications: {{ applications|length }}</p>
        
        {% if applications %}
            <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
                <ul class="divide-y divide-gray-200">
                    <li class="p-4 bg-gray-100 grid grid-cols-12 gap-4 font-semibold text-gray-700 sticky top-0 border-b border-gray-300">
                        <div class="col-span-4">Candidate Name</div>
                        <div class="col-span-4">Email</div>
                        <div class="col-span-2 text-center">Score</div>
                        <div class="col-span-2 text-right">Applied Date</div>
                    </li>
                    {% for application in applications %}
                        <li class="p-4 grid grid-cols-12 gap-4 hover:bg-gray-50 transition duration-100">
                            <div class="col-span-4 text-gray-900 font-medium">{{ application.candidate_name }}</div>
                            <div class="col-span-4 text-gray-600 truncate">{{ application.email }}</div>
                            <div class="col-span-2 text-center text-lg font-bold 
                                {% if application.score >= 80 %}text-success
                                {% elif application.score >= 50 %}text-warning
                                {% else %}text-danger
                                {% endif %}">
                                {{ application.score }}%
                            </div>
                            <div class="col-span-2 text-right text-sm text-gray-500">{{ application.date_applied.strftime('%Y-%m-%d') }}</div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            
            <div class="mt-8 p-4 bg-primary/10 rounded-xl border-l-4 border-primary shadow-inner">
                <h3 class="text-xl font-semibold text-primary">AI Scoring Explained</h3>
                <p class="text-gray-700 mt-2">
                    The score is calculated using <span class="font-mono bg-gray-200 px-1 rounded">TF-IDF</span> and <span class="font-mono bg-gray-200 px-1 rounded">Cosine Similarity</span> to determine how well the resume's text matches the keywords and content in the job description. Higher scores indicate a better match.
                </p>
            </div>

        {% else %}
            <div class="text-center p-12 bg-white rounded-xl shadow-inner border-4 border-dashed border-gray-300">
                <p class="text-xl text-gray-500 font-semibold">No applications yet for this job.</p>
                <p class="text-gray-400 mt-2">Wait for candidates to start applying!</p>
            </div>
        {% endif %}
        
    {% endif %}

    <!-- Footer Spacer -->
    <div class="py-12"></div> 

</main>

<footer class="bg-gray-800 text-white mt-auto py-4">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm">
        SmartHire AI Recruitment Solution | Powered by Flask & SQLAlchemy
    </div>
</footer>

</body>
</html>
