<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #C3EBFF;
            padding-bottom: 60px;
            scroll-behavior: smooth;
        }

        /* Navbar */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #B2D3FD;
            padding: 15px 30px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .navbar .logo {
            font-size: 20px;
            font-weight: bold;
            color: #08106E;
        }
        .navbar .right-side {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        .navbar .menu {
            display: flex;
            gap: 20px;
        }
        .navbar .menu a {
            color: #08106E;
            text-decoration: none;
            font-weight: bold;
        }
        .navbar .menu a:hover {
            text-decoration: underline;
        }
        .logout-btn {
            background: #08106E;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .logout-btn:hover {
            background: #2e3a8c;
        }

        /* Page Content */
        .content {
            padding: 30px;
        }

        /* Alert */
        .alert {
            position: fixed;
            top: 80px;
            right: 30px;
            background: #08106E;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0px 3px 6px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.5s ease;
            z-index: 2000;
        }
        .alert.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Card */
        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0px 3px 6px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        .card h2 {
            margin-top: 0;
            color: #08106E;
        }
        .card p {
            color: #333;
        }

        /* Dashboard Image + Slider + Overlay */
        .dashboard-image-container {
            position: relative;
            width: 100%;
            margin-bottom: 30px;
            border-radius: 20px;
            overflow: hidden;
        }
        .slides {
            position: relative;
            width: 100%;
            height: 300px;
            overflow: hidden;
        }
        .slides img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        .slides img.active {
            opacity: 1;
        }
        .overlay-card {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.25);
            max-width: 60%;
        }
        .overlay-card h2 {
            margin: 0 0 8px;
            color: #08106E;
            font-size: 26px;
        }
        .overlay-card p {
            margin: 0;
            font-size: 16px;
            color: #333;
        }

        /* Stats Section */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: #08106E;
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0px 3px 6px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            background: #0c1596;
        }
        .stat-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .stat-card p {
            font-size: 32px;
            font-weight: bold;
            margin: 0;
            color: #fff;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0px 3px 6px rgba(0,0,0,0.1);
        }
        table thead {
            background: #08106E;
            color: white;
        }
        table th, table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }
        table tr:hover {
            background: #f1f4ff;
        }

        /* Footer */
        .footer {
            background: #F0F1F7;
            color: #08106E;
            text-align: center;
            padding: 15px;
            font-weight: bold;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            box-shadow: 0px -2px 6px rgba(0,0,0,0.1);
        }

        /* Tabs + Buttons */
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab {
            padding: 8px 16px;
            background: #f1f1f1;
            border: none;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
        }
        .tab.active {
            background: #007bff;
            color: #fff;
            font-weight: bold;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        input[type="text"] { width: 100%; padding: 6px; margin: 8px 0; }
        label { display: block; margin-top: 10px; font-weight: bold; color: #08106E; }

        .edit-btn, .delete-btn {
            padding: 5px 10px;
            margin: 2px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .edit-btn { background: #ffc107; color: #000; }
        .delete-btn {
            background: #6c757d;
            color: #fff;
        }
        .delete-btn:hover {
            background: #5a6268;
        }

        /* Modals */
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0,0,0,0.5); 
            justify-content: center; 
            align-items: center;
            z-index: 3000; 
        }
        .modal-content { 
            background: #fff; 
            padding: 20px; 
            border-radius: 8px; 
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: scale(0.95);
            transition: transform 0.3s ease-out;
        }
        .modal.show .modal-content {
            transform: scale(1);
        }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }

        /* Added controls */
        .show-all-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: #08106E;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
        }
        .show-all-btn:hover { background: #0c1596; }

        .placeholder-text {
            text-align: left;
            margin-top: 5px;
            margin-left: 5px;
            color: #555;
            font-style: italic;
        }

        .section-label {
            text-align: left;
            font-weight: bold;
            color: #08106E;
            font-size: 18px;
            margin-top: 10px;
            margin-left: 5px;
        }

        .search-box {
            display: flex;
            justify-content: flex-end;
            margin-top: 12px;
        }
        .search-box input {
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 260px;
        }

        @media (max-width: 700px) {
            .search-box { justify-content: stretch; }
            .search-box input { width: 100%; }
            .stats-container { grid-template-columns: 1fr 1fr; }
            .overlay-card { max-width: 80%; padding: 15px; }
            .navbar .right-side { flex-direction: column; gap: 10px; }
            .navbar .menu { justify-content: center; }
        }

        /* Status Pills */
        .status-pill {
          padding: 4px 10px;
          border-radius: 12px;
          font-weight: 700;
          font-size: 13px;
          text-align: center;
          display: inline-block;
        }
        .status-active { background: rgba(12,154,62,0.1); color: #0c9a3e; }
        .status-pending { background: rgba(230,167,0,0.1); color: #e6a700; }
        .status-inactive { background: rgba(200,0,0,0.1); color: #c00; }

    </style>
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="logo">SmartHire Admin</div>
        <div class="right-side">
            <div class="menu">
                <a href="#dashboard">Dashboard</a>
                <a href="#job-post">Job Post</a>
                <a href="#user-management">User Management</a>
            </div>
            <form action="/" method="GET">
                <button class="logout-btn" onclick="showNotification('Logged out successfully!');">Logout</button>
            </form>
        </div>
    </div>

    <!-- Alert -->
    <div id="alert" class="alert"></div>

    <div class="content">
        <h1>Welcome, Admin!</h1>

        <!-- Dashboard -->
        <div class="card" id="dashboard">
            <div class="dashboard-image-container">
                <div class="slides">
                    <img src="{{ url_for('static', filename='images/dashboardE1.jpg') }}" alt="Slide 1">
                    <img src="{{ url_for('static', filename='images/dashboardE2.jpg') }}" alt="Slide 2">
                    <img src="{{ url_for('static', filename='images/dashboardE3.jpg') }}" alt="Slide 3">
                </div>
                <div class="overlay-card">
                    <h2>📊 Dashboard</h2>
                    <p>Real-Time Monitoring of Platform Stats and Users</p>
                </div>
            </div>
            <div class="stats-container">
                <div class="stat-card" onclick="showDetails('Applicant', 'Applicants')">
                    <h3>Applicants</h3>
                    <!-- Added ID and set default count to 0 -->
                    <p id="stat-applicants">0</p> 
                </div>
                <div class="stat-card" onclick="showDetails('Employer', 'Registered Employers')">
                    <h3>Registered Employers</h3>
                    <!-- Added ID and set default count to 0 -->
                    <p id="stat-employers">0</p> 
                </div>
                <div class="stat-card" onclick="showDetails('Job', 'Jobs Posted')">
                    <h3>Jobs Posted</h3>
                    <!-- Added ID and set default count to 0 -->
                    <p id="stat-jobs">0</p> 
                </div>
                <div class="stat-card" onclick="showDetails('Resume', 'Resumes Uploaded')">
                    <h3>Resumes Uploaded</h3>
                                        <p id="stat-resumes">{{ resume_count }}</p>
                </div>
            </div>

<h2 style="margin-top:40px;">📋 Detailed Records</h2>
<p id="placeholderText" class="placeholder-text">Select a section above to view detailed records.</p>
<p id="sectionLabel" class="section-label"></p>

<table id="recordsTable" style="display:none;">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name / Title</th>
            <th>Role / Type</th>
            <th>Email / Company</th>
            <th>Extra Info</th>
        </tr>
    </thead>
    <tbody>
        <!-- Applicants -->
        {% for applicant in applicants_list %}
        <tr data-role="Applicant">
            <td>{{ applicant.id }}</td>
            <td>{{ applicant.fullname }}</td>
            <td>Applicant</td>
            <td>{{ applicant.email }}</td>
            <td>Skills: {{ applicant.skills or 'N/A' }} | Experience: {{ applicant.experience or '0 years' }}</td>
        </tr>
        {% endfor %}

        <!-- Employers -->
        {% for employer in employers_list %}
        <tr data-role="Employer">
            <td>{{ employer.id }}</td>
            <td>{{ employer.fullname }}</td>
            <td>Employer</td>
            <td>{{ employer.email }}</td>
            <td>Company: {{ employer.company or 'N/A' }}</td>
        </tr>
        {% endfor %}

        <!-- Jobs -->
{% for job in all_jobs %}
<tr data-role="Job">
    <td>{{ job.id }}</td>
    <td>{{ job.title }}</td>
    <td>Job</td>
    <td>{{ job.company }}</td>
    <td>Location: {{ job.location or 'N/A' }}</td>
</tr>
{% endfor %}

    </tbody>
</table>
            <!-- Show All button -->
            <div style="text-align:left;">
                <button id="showAllBtn" class="show-all-btn" onclick="showDetails('All', 'All Records')">Show All Records</button>
            </div>
        </div>

<!-- Job Post Management -->
<div class="card" id="job-post">
    <h2>💼 Job Post Management</h2>
    <p>Manage and review all job postings submitted by employers.</p>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab active" onclick="showJobTab('approvedJobs', this)">Approved</button>
        <button class="tab" onclick="showJobTab('pendingJobs', this)">Pending</button>
    </div>

    <!-- Search Box -->
    <input type="text" id="searchJobs" onkeyup="searchTable('searchJobs','jobPostsTable,pendingJobPostsTable')" placeholder="🔍 Search job posts..." style="margin-bottom:10px; padding:6px; width:100%;">

    <!-- Approved Jobs -->
    <div id="approvedJobs" class="tab-content active">
        <table id="jobPostsTable">
            <thead>
                <tr>
                    <th>Job ID</th>
                    <th>Title</th>
                    <th>Company</th>
                    <th>Location</th>
                    <th>Date Posted</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for job in approved_jobs %}
                <tr>
                    <td>{{ job.id }}</td>
                    <td>{{ job.title }}</td>
                    <td>{{ job.company }}</td>
                    <td>{{ job.location }}</td>
                    <td>{{ job.created_at.strftime('%Y-%m-%d') if job.created_at else 'N/A' }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('archive_job', job_id=job.id) }}">
                            <button type="submit" class="delete-btn">Archive</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pending Jobs -->
    <div id="pendingJobs" class="tab-content">
        <table id="pendingJobPostsTable">
            <thead>
                <tr>
                    <th>Job ID</th>
                    <th>Title</th>
                    <th>Company</th>
                    <th>Location</th>
                    <th>Date Posted</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for job in pending_jobs %}
                <tr>
                    <td>{{ job.id }}</td>
                    <td>{{ job.title }}</td>
                    <td>{{ job.company }}</td>
                    <td>{{ job.location }}</td>
                    <td>{{ job.created_at.strftime('%Y-%m-%d') if job.created_at else 'N/A' }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('approve_job', job_id=job.id) }}">
                            <button type="submit" class="edit-btn" style="background:#28a745;color:white;">Approve</button>
                        </form>
                        <form method="POST" action="{{ url_for('archive_job', job_id=job.id) }}" style="margin-top:5px;">
                            <button type="submit" class="delete-btn">Archive</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    // Switch between Approved and Pending tabs
    function showJobTab(tabId, btn) {
        document.querySelectorAll("#job-post .tab-content").forEach(c => c.classList.remove("active"));
        document.querySelectorAll("#job-post .tab").forEach(t => t.classList.remove("active"));
        document.getElementById(tabId).classList.add("active");
        if (btn) btn.classList.add("active");
        document.getElementById('searchJobs').value = '';
        searchTable('searchJobs','jobPostsTable,pendingJobPostsTable');
    }
</script>

<!-- User Management -->
<div class="card" id="user-management">
    <h2>👤 User Management</h2>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab active" onclick="showTab('applicants', this)">Applicants</button>
        <button class="tab" onclick="showTab('employers', this)">Employers</button>
    </div>

    <!-- Applicants Tab -->
    <div id="applicants" class="tab-content active">
        <input type="text" id="searchApplicants" onkeyup="searchTable('searchApplicants','applicantsTable')" placeholder="🔍 Search Applicants..." style="margin-bottom:10px; padding:6px; width:100%;">
        <table id="applicantsTable">
            <thead>
                <tr>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Skills</th>
                    <th>Experience</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for applicant in applicants_list %}
                <tr>
                    <td>{{ applicant.fullname }}</td>
                    <td>{{ applicant.email }}</td>
                    <td>{{ applicant.skills }}</td>
                    <td>{{ applicant.experience }}</td>
                    <td>
                        <button class="edit-btn" onclick="openEditModal(this)">Edit</button>
                        <button class="delete-btn" onclick="openConfirmationModal(this, 'archive')">Archive</button>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Employers Tab -->
    <div id="employers" class="tab-content">
        <input type="text" id="searchEmployers" onkeyup="searchTable('searchEmployers','employersTable')" placeholder="🔍 Search Employers..." style="margin-bottom:10px; padding:6px; width:100%;">
        <table id="employersTable">
            <thead>
                <tr>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Company</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for employer in employers_list %}
                <tr>
                    <td>{{ employer.fullname }}</td>
                    <td>{{ employer.email }}</td>
                    <td>{{ employer.company }}</td>
                    <td>
                        <button class="edit-btn" onclick="openEditModal(this)">Edit</button>
                        <button class="delete-btn" onclick="openConfirmationModal(this, 'archive')">Archive</button>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

    </div>
    <!-- Footer -->
    <footer class="footer">© 2025 SmartHire. All rights reserved.</footer>

    <!-- MODALS -->

    <!-- 1. Confirmation Modal (for delete/archive) -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <h3 style="color:#D9534F;">Confirmation Required</h3>
            <p id="confirmationMessage">Are you sure you want to archive this record?</p>
            <div class="modal-actions">
                <button class="delete-btn" onclick="closeConfirmationModal()">Cancel</button>
                <button class="edit-btn" style="background:#D9534F; color:white;" id="confirmActionBtn">Confirm Archive</button>
            </div>
        </div>
    </div>

    <!-- 2. Edit Modal (for simulating edit page) -->
    <div id="editModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3 id="editModalTitle" style="color:#08106E; margin-bottom: 20px;">Edit Record</h3>
            <form id="editForm">
                <!-- Fields dynamically populated here -->
                <div id="editFormFields"></div>
            </form>
            <div class="modal-actions" style="justify-content: flex-end;">
                <button type="button" class="delete-btn" onclick="closeEditModal()">Cancel</button>
                <button type="button" class="edit-btn" style="background:#28a745; color:white;" onclick="saveEditChanges()">Save Changes</button>
            </div>
        </div>
    </div>

<script>
/** Global Variables */
let rowToDelete = null; // For archive/delete modal
let rowToEdit = null;    // For edit modal
let cellsToUpdate = []; // Cells being edited

/** Notification */
function showNotification(message) {
    const alertBox = document.getElementById("alert");
    alertBox.textContent = message;
    alertBox.classList.add("show");
    setTimeout(() => alertBox.classList.remove("show"), 3000);
}

/** Update Dashboard Stats */
function updateDashboardStats() {
    // Only update stats that are based on data tables in User Management/Job Post
    const userMgtApplicants = document.querySelectorAll("#applicantsTable tbody tr").length;
    document.getElementById("stat-applicants").textContent = userMgtApplicants;

    const userMgtEmployers = document.querySelectorAll("#employersTable tbody tr").length;
    document.getElementById("stat-employers").textContent = userMgtEmployers;

    const approvedJobs = document.querySelectorAll("#jobPostsTable tbody tr").length;
    const pendingJobs = document.querySelectorAll("#pendingJobPostsTable tbody tr").length;
    document.getElementById("stat-jobs").textContent = approvedJobs + pendingJobs;
    
    // The Resume count is intentionally skipped here because its value is set directly by Jinja2 
    // when the page is rendered: <p id="stat-resumes">{{ resume_count }}</p>
}

/** Initialize Everything After DOM Loaded */
window.addEventListener('DOMContentLoaded', () => {
    showNotification("Welcome to your Admin Dashboard!");
    updateDashboardStats();

    // Dashboard table setup
    document.getElementById('showAllBtn').style.display = 'inline-block';
    document.getElementById('placeholderText').style.display = 'block';
    document.getElementById('recordsTable').style.display = 'none';

    // Close modals on clicking outside
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                modal.style.display = 'none';
            }
        });
    });

    /** Image Slider */
    const sliderImages = document.querySelectorAll('.slides img');
    let currentSlide = 0;

    function showSlide(index) {
        sliderImages.forEach((img, i) => img.classList.remove('active'));
        sliderImages[index].classList.add('active');
    }

    function nextSlide() {
        currentSlide = (currentSlide + 1) % sliderImages.length;
        showSlide(currentSlide);
    }

    if(sliderImages.length > 0){
        showSlide(currentSlide);
        setInterval(nextSlide, 3000); // every 3s
    }
});

/** Dashboard Details Table */
function showDetails(type, labelText = '') {
    const table = document.getElementById("recordsTable");
    const rows = table.querySelectorAll("tbody tr");
    const placeholder = document.getElementById("placeholderText");
    const sectionLabel = document.getElementById("sectionLabel");

    table.style.display = "table";
    placeholder.style.display = "none";

    if(type === "All") {
        rows.forEach(r => r.style.display = "");
        sectionLabel.textContent = "All Records";
        return;
    }

    rows.forEach(row => {
        row.style.display = (row.dataset.role && row.dataset.role.toLowerCase() === type.toLowerCase()) ? "" : "none";
    });

    sectionLabel.textContent = labelText || '';
}

/** Tabs */
function showTab(tabId, btn) {
    document.querySelectorAll("#user-management .tab-content").forEach(c => c.classList.remove("active"));
    document.querySelectorAll("#user-management .tab").forEach(t => t.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
    if(btn) btn.classList.add("active");

    // Clear search boxes
    document.getElementById('searchApplicants').value = '';
    document.getElementById('searchEmployers').value = '';
    searchTable('searchApplicants','applicantsTable');
    searchTable('searchEmployers','employersTable');
}

/** Job Tabs */
function showJobTab(tabId, btn) {
    document.querySelectorAll("#job-post .tab-content").forEach(c => c.classList.remove("active"));
    document.querySelectorAll("#job-post .tab").forEach(t => t.classList.remove("active"));
    document.getElementById(tabId).classList.add("active");
    if(btn) btn.classList.add("active");

    document.getElementById('searchJobs').value = '';
    searchTable('searchJobs','jobPostsTable,pendingJobPostsTable');
}

/** Search Function */
function searchTable(inputId, tableIds) {
    const input = document.getElementById(inputId).value.toUpperCase();
    const ids = tableIds.split(',');
    
    ids.forEach(tableId => {
        const table = document.getElementById(tableId.trim());
        if(!table) return;
        const rows = table.getElementsByTagName("tr");
        for(let i = 1; i < rows.length; i++) {
            rows[i].style.display = rows[i].innerText.toUpperCase().includes(input) ? "" : "none";
        }
    });
}

/** Confirmation Modal */
function openConfirmationModal(btn, actionType) {
    rowToDelete = btn.closest("tr");
    const modal = document.getElementById('confirmationModal');
    const confirmBtn = document.getElementById('confirmActionBtn');
    const name = rowToDelete.cells[0].innerText;

    document.getElementById('confirmationMessage').textContent = `Are you sure you want to ${actionType} the record for "${name}"?`;
    confirmBtn.textContent = `Confirm ${actionType.charAt(0).toUpperCase() + actionType.slice(1)}`;
    confirmBtn.onclick = () => { deleteRow(rowToDelete); closeConfirmationModal(); updateDashboardStats(); };

    modal.style.display = 'flex';
    modal.classList.add('show');
}

function closeConfirmationModal() {
    document.getElementById('confirmationModal').style.display = 'none';
    document.getElementById('confirmationModal').classList.remove('show');
    rowToDelete = null;
}

function deleteRow(row) {
    if(row) {
        const name = row.cells[0].innerText;
        row.remove();
        showNotification(`Record for "${name}" successfully archived.`);
    }
}

/** Edit Modal */
function openEditModal(btn) {
    rowToEdit = btn.closest("tr");
    cellsToUpdate = Array.from(rowToEdit.cells).slice(0, -1);

    const role = rowToEdit.closest("#applicantsTable") ? "Applicant" : "Employer";
    const modal = document.getElementById('editModal');
    document.getElementById('editModalTitle').textContent = `Edit ${role} Record`;

    const fieldsContainer = document.getElementById('editFormFields');
    fieldsContainer.innerHTML = '';
    const headers = Array.from(rowToEdit.closest('table').querySelectorAll('thead th')).map(th => th.textContent);

    for(let i = 0; i < cellsToUpdate.length; i++){
        const value = cellsToUpdate[i].innerText;
        const fieldId = `edit-field-${i}`;
        const fieldDiv = document.createElement('div');
        fieldDiv.innerHTML = `<label for="${fieldId}">${headers[i]}</label>
            <input type="text" id="${fieldId}" value="${value}" name="${headers[i].toLowerCase().replace(/ /g,'-')}" required>`;
        fieldsContainer.appendChild(fieldDiv);
    }

    modal.style.display = 'flex';
    modal.classList.add('show');
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
    document.getElementById('editModal').classList.remove('show');
    rowToEdit = null;
    cellsToUpdate = [];
}

function saveEditChanges() {
    if(rowToEdit && cellsToUpdate.length > 0) {
        for(let i=0; i<cellsToUpdate.length; i++){
            const input = document.getElementById(`edit-field-${i}`);
            if(input) cellsToUpdate[i].innerText = input.value;
        }
        closeEditModal();
        showNotification(`Changes saved successfully for "${document.getElementById('edit-field-0').value}"!`);
        updateDashboardStats();
    } else {
        closeEditModal();
        showNotification("Error: Could not update record.", 'error');
    }
}
</script>
</body>
</html>
